# fail2ban jail configuration - Security Hardened
# Generated by Ansible - JTerrazz Infrastructure

[DEFAULT]
# Ignore IPs (whitelist)
ignoreip = {{ fail2ban_ignoreip }}

# Ban settings  
bantime = {{ fail2ban_bantime }}
findtime = {{ fail2ban_findtime }}
maxretry = {{ fail2ban_maxretry }}

# Backend for log parsing
backend = auto

# Email settings (configure if needed)
destemail = root@localhost
sender = root@localhost
mta = sendmail
action = %(action_)s

[sshd]
enabled = true
port = {{ ssh_port }}
filter = sshd
logpath = /var/log/auth.log
maxretry = {{ fail2ban_maxretry }}
bantime = {{ fail2ban_bantime }}

[sshd-ddos]
enabled = true
port = {{ ssh_port }}
filter = sshd-ddos
logpath = /var/log/auth.log
maxretry = 2
bantime = {{ fail2ban_bantime }}

# Web server protection (nginx)
[nginx-http-auth]
enabled = true
filter = nginx-http-auth
logpath = /var/log/nginx/error.log
maxretry = 5
bantime = {{ fail2ban_bantime }}

[nginx-limit-req]
enabled = true
filter = nginx-limit-req
logpath = /var/log/nginx/error.log
maxretry = 5
bantime = {{ fail2ban_bantime }}

[nginx-botsearch]
enabled = true
filter = nginx-botsearch
logpath = /var/log/nginx/access.log
maxretry = 5
bantime = {{ fail2ban_bantime }}

# Additional protections
[recidive]
enabled = true
filter = recidive
logpath = /var/log/fail2ban.log
action = %(action_mwl)s
bantime = 1w
findtime = 1d
maxretry = 5
