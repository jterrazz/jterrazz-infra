# Unattended upgrades configuration  
# Generated by Ansible - JTerrazz Infrastructure

Unattended-Upgrade::Allowed-Origins {
    "${distro_id}:${distro_codename}";
    "${distro_id}:${distro_codename}-security";
    "${distro_id}ESMApps:${distro_codename}-apps-security";
    "${distro_id}ESM:${distro_codename}-infra-security";
    "${distro_id}:${distro_codename}-updates";
};

# Packages to never automatically upgrade
Unattended-Upgrade::Package-Blacklist {
    // k3s components (manage manually via k3s)
    "k3s";
};

{% if security_auto_reboot_enabled %}
# Automatic reboot settings
Unattended-Upgrade::Automatic-Reboot "true";
Unattended-Upgrade::Automatic-Reboot-Time "{{ security_auto_reboot_time }}";
Unattended-Upgrade::Automatic-Reboot-WithUsers "false";
{% else %}
# No automatic reboot
Unattended-Upgrade::Automatic-Reboot "false";
{% endif %}

# Email settings
Unattended-Upgrade::Mail "root@localhost";
Unattended-Upgrade::MailReport "on-change";

# Cleanup settings
Unattended-Upgrade::Remove-Unused-Kernel-Packages "true";
Unattended-Upgrade::Remove-New-Unused-Dependencies "true";
Unattended-Upgrade::Remove-Unused-Dependencies "true";
Unattended-Upgrade::AutoFixInterruptedDpkg "true";

# System behavior
Unattended-Upgrade::MinimalSteps "true";
Unattended-Upgrade::InstallOnShutdown "false";
Unattended-Upgrade::Skip-Updates-On-Metered-Connections "true";

# Logging
Unattended-Upgrade::Verbose "false";
Unattended-Upgrade::Debug "false";
Unattended-Upgrade::SyslogEnable "true";
Unattended-Upgrade::SyslogFacility "daemon";
