# SSH Daemon Configuration
# Managed by Ansible - Do not edit manually

Port {{ security_ssh_port }}
AddressFamily inet
ListenAddress 0.0.0.0
Protocol 2

# Host Keys
HostKey /etc/ssh/ssh_host_ed25519_key
HostKey /etc/ssh/ssh_host_rsa_key
HostKey /etc/ssh/ssh_host_ecdsa_key

# Security - Modern ciphers only
Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com
MACs hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com
KexAlgorithms curve25519-sha256@libssh.org,ecdh-sha2-nistp521,ecdh-sha2-nistp384

# Authentication
PermitRootLogin {{ security_ssh_permit_root_login }}
PubkeyAuthentication {{ security_ssh_pubkey_authentication }}
PasswordAuthentication {{ security_ssh_password_authentication }}
ChallengeResponseAuthentication no
GSSAPIAuthentication no
UsePAM yes

# Limits
MaxAuthTries {{ security_ssh_max_auth_tries }}
MaxSessions 3
MaxStartups 3:50:10

# Timeouts
ClientAliveInterval {{ security_ssh_client_alive_interval }}
ClientAliveCountMax {{ security_ssh_client_alive_count_max }}
LoginGraceTime 30

# Restrictions
X11Forwarding no
AllowTcpForwarding no
AllowAgentForwarding no
PermitTunnel no
PermitEmptyPasswords no
PermitUserEnvironment no

# Logging
SyslogFacility AUTH
LogLevel VERBOSE

# User Access
{% if security_ssh_allowed_users %}
AllowUsers {{ security_ssh_allowed_users | join(' ') }}
{% endif %}

# SFTP
Subsystem sftp internal-sftp
