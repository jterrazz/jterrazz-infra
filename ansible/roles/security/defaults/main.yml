---
# Security Role - Default Variables

# SSH Configuration
security_ssh_port: 22
security_ssh_permit_root_login: "prohibit-password"
security_ssh_password_authentication: "no"
security_ssh_pubkey_authentication: "yes"
security_ssh_max_auth_tries: 3
security_ssh_client_alive_interval: 300
security_ssh_client_alive_count_max: 2
security_ssh_allowed_users: []

# Firewall (UFW)
security_ufw_enabled: true
security_ufw_default_incoming: "deny"
security_ufw_default_outgoing: "allow"
security_ufw_default_forward: "deny"

# Lock SSH to Tailscale only (set to true after Tailscale is confirmed working)
security_ssh_tailscale_only: false

# Base firewall rules
security_ufw_rules:
  - { port: "80", proto: "tcp", rule: "allow", comment: "HTTP" }
  - { port: "443", proto: "tcp", rule: "allow", comment: "HTTPS" }
  - { port: "6443", proto: "tcp", rule: "allow", from: "100.64.0.0/10", comment: "K8s API (Tailscale)" }
  - { port: "6443", proto: "tcp", rule: "allow", from: "10.0.0.0/8", comment: "K8s API (Private)" }
  - { port: "6443", proto: "tcp", rule: "allow", from: "172.16.0.0/12", comment: "K8s API (Private)" }
  - { port: "6443", proto: "tcp", rule: "allow", from: "192.168.0.0/16", comment: "K8s API (Private)" }

# SSH rules - separate so we can conditionally restrict them
security_ufw_ssh_rules_public:
  - { port: "22", proto: "tcp", rule: "allow", comment: "SSH (public)" }

security_ufw_ssh_rules_tailscale:
  - { port: "22", proto: "tcp", rule: "allow", from: "100.64.0.0/10", comment: "SSH (Tailscale only)" }

# Fail2ban
security_fail2ban_enabled: true
security_fail2ban_ignoreip: "127.0.0.1/8 ::1"
security_fail2ban_bantime: "1h"
security_fail2ban_findtime: "10m"
security_fail2ban_maxretry: 5

# Automatic Updates
security_auto_updates_enabled: true
security_auto_reboot_enabled: false
security_auto_reboot_time: "06:00"

# System Hardening
security_secure_shared_memory: true
security_disable_uncommon_protocols: true

# Kernel Security Parameters
security_kernel_params:
  - { name: "net.ipv4.tcp_syncookies", value: "1" }
  - { name: "net.ipv4.icmp_echo_ignore_broadcasts", value: "1" }
  - { name: "net.ipv4.icmp_ignore_bogus_error_responses", value: "1" }
  - { name: "net.ipv4.conf.all.accept_source_route", value: "0" }
  - { name: "net.ipv4.conf.default.accept_source_route", value: "0" }
  - { name: "net.ipv4.conf.all.rp_filter", value: "1" }
  - { name: "net.ipv4.conf.default.rp_filter", value: "1" }
