{{- if eq (include "app.envExists" .) "true" -}}
# Registry pull secret for private registry
# Credentials synced from Infisical /registry path
apiVersion: secrets.infisical.com/v1alpha1
kind: InfisicalSecret
metadata:
  name: registry-infisical
  labels:
    {{- include "app.labels" . | nindent 4 }}
spec:
  hostAPI: https://eu.infisical.com
  resyncInterval: 300
  authentication:
    universalAuth:
      secretsScope:
        projectSlug: jterrazz
        envSlug: {{ include "app.infisicalEnv" . }}
        secretsPath: /registry
      credentialsRef:
        secretName: infisical-credentials
        secretNamespace: platform-secrets
  managedSecretReference:
    secretName: registry-credentials
    secretNamespace: {{ include "app.namespace" . }}
    secretType: kubernetes.io/dockerconfigjson
{{- end }}
